(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const a=document.getElementById("root"),F=new URLSearchParams(window.location.search),f=F.get("messaging_handle"),p=F.get("messaging_origin"),m=window.opener||window.parent;let c=null,d=null,R=null,y=null;function L(){return Math.random().toString(36).slice(2,10)}function w(s){!m||!p||m.postMessage(s,p)}function I(s,e,n){const t=e.messageType||"response",r=e.messageId||"-",o=e.responseToMessageId||"-",u=e.messagingHandle||"-";if(n===void 0){console.log(`[${s}] type=${t} id=${r} respTo=${o} handle=${u}`);return}console.log(`[${s}] type=${t} id=${r} respTo=${o} handle=${u}`,n)}function H(s,e){const n={messagingHandle:f,messageId:L(),messageType:s,payload:e};I("out",n,e),w(n)}function l(s,e,n){const t={messagingHandle:f,messageId:L(),messageType:s,responseToMessageId:e,payload:n};I("out",t,n),w(t)}function T(s,e,n){return{resourceType:"OperationOutcome",issue:[{severity:s,code:e,diagnostics:n}]}}function i(s,e,n,t){const r={status:n};t&&(r.outcome=T("error","invalid",t)),l(s,e,r)}function g(){return window.LForms&&window.LForms.Util?window.LForms.Util:null}function q(){a&&(a.innerHTML="")}function M(s){const e=g();return e&&typeof e.convertFHIRQuestionnaireToLForms=="function"?e.convertFHIRQuestionnaireToLForms(s):s}function O(s,e){const n=g();return!n||!e?s:typeof n.mergeFHIRQuestionnaireResponse=="function"?n.mergeFHIRQuestionnaireResponse(s,e):typeof n.mergeFHIRDataIntoLForms=="function"?n.mergeFHIRDataIntoLForms(s,e):(typeof n.setFHIRQuestionnaireResponse=="function"&&n.setFHIRQuestionnaireResponse(e),s)}function h(s,e){const n=g();if(!n||!a)return!1;const t=M(s),r=O(t,e);if(q(),typeof n.addFormToPage=="function"){const o=a.id||"root";return n.addFormToPage(r,o),!0}return!1}function C(){const s=g();return s?typeof s.getFormFHIRData=="function"?s.getFormFHIRData("QuestionnaireResponse","R4"):typeof s.getFormData=="function"?s.getFormData():null:null}function Q(){R&&(y&&clearTimeout(y),y=setTimeout(()=>{const s=C();s&&R(s)},50))}function v(){a&&(a.addEventListener("change",Q,!0),a.addEventListener("input",Q,!0))}if(!f||!p)throw new Error("Missing SDC SWM parameters");R=s=>{d=s,H("sdc.ui.changedQuestionnaireResponse",{questionnaireResponse:s})};v();H("status.handshake",{protocolVersion:"1.0",fhirVersion:"R4"});window.addEventListener("message",s=>{if(!m||s.source!==m||s.origin!==p)return;const e=s.data||{};if(I("in",e,e.payload),!(e.messagingHandle&&e.messagingHandle!==f)&&e.messageType)switch(e.messageType){case"status.handshake":l("status.handshake",e.messageId,{application:{name:"LHC-Forms",publisher:"NLM Lister Hill National Center for Biomedical Communications"},capabilities:{extraction:!1,focusChangeNotifications:!1}});return;case"sdc.configure":i("sdc.configure",e.messageId,"success");return;case"sdc.configureContext":i("sdc.configureContext",e.messageId,"success");return;case"sdc.displayQuestionnaire":{const n=e.payload&&e.payload.questionnaire?e.payload.questionnaire:e.payload;if(!n||n.resourceType!=="Questionnaire"){i("sdc.displayQuestionnaire",e.messageId,"error","Missing questionnaire in sdc.displayQuestionnaire.");return}if(!window.LForms){i("sdc.displayQuestionnaire",e.messageId,"error","LHC-Forms script not loaded.");return}if(c=n,d=e.payload&&e.payload.questionnaireResponse?e.payload.questionnaireResponse:d,!h(c,d)){i("sdc.displayQuestionnaire",e.messageId,"error","LHC-Forms renderer is not available.");return}i("sdc.displayQuestionnaire",e.messageId,"success");return}case"sdc.displayQuestionnaireResponse":{const n=e.payload&&e.payload.questionnaireResponse?e.payload.questionnaireResponse:e.payload;if(!n||n.resourceType!=="QuestionnaireResponse"){i("sdc.displayQuestionnaireResponse",e.messageId,"error","Missing questionnaireResponse in sdc.displayQuestionnaireResponse.");return}if(!window.LForms){i("sdc.displayQuestionnaireResponse",e.messageId,"error","LHC-Forms script not loaded.");return}d=n;const t=e.payload&&e.payload.questionnaire?e.payload.questionnaire:c;if(t&&t.resourceType==="Questionnaire"&&(c=t),!c){i("sdc.displayQuestionnaireResponse",e.messageId,"error","Questionnaire is required to render QuestionnaireResponse.");return}if(!h(c,d)){i("sdc.displayQuestionnaireResponse",e.messageId,"error","LHC-Forms renderer is not available.");return}i("sdc.displayQuestionnaireResponse",e.messageId,"success");return}case"sdc.requestCurrentQuestionnaireResponse":{const n=C();if(n){l("sdc.requestCurrentQuestionnaireResponse",e.messageId,{questionnaireResponse:n});return}l("sdc.requestCurrentQuestionnaireResponse",e.messageId,{outcome:T("error","not-found","No QuestionnaireResponse is currently loaded.")});return}case"sdc.requestExtract":l("sdc.requestExtract",e.messageId,{outcome:{resourceType:"OperationOutcome",issue:[{severity:"error",code:"not-supported",diagnostics:"Extract is not implemented in this renderer."}]}});return;default:l(e.messageType||"response",e.messageId,{status:"error",statusDetail:{message:"Unsupported message type"}})}});
