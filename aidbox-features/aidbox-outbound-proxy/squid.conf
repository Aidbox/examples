http_port 3128
http_port 8080 accel vhost

# Reverse proxy to aidbox
cache_peer aidbox parent 8080 0 no-query originserver name=aidbox
acl aidbox_access port 8080
cache_peer_access aidbox allow aidbox_access
cache_peer_access aidbox deny all

# Allow all Docker networks
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16

# Safe ports
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443

# Allow CONNECT to SSL ports
acl CONNECT method CONNECT

# Add 8080 as safe port for reverse proxy
acl Safe_ports port 8080

# Deny requests to unsafe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow access from local networks
http_access allow localnet

# Allow reverse proxy access from anywhere (for aidbox UI)
http_access allow aidbox_access

# Deny all other access
http_access deny all

# Logging
access_log /var/log/squid/access.log squid
